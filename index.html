<!doctype html>
<html>
    <head>
        <title>Plotly Homework 6</title>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <meta charset="utf-8" />
    </head>
    <head>

     <body>
<div class="showcase__section" id="bubble">
<div class="spacer --small"></div>
<div id="bubbleplots">
 <div class="bubbleplot" data-num="0">
   <div class="plot" id="plotdiv"></div>
   <div class="control-row">
     Make: <select class="Makedata">
     </select>
   </div>
 </div>
</div>
</div>

<script>
  //Read data
      Plotly.d3.csv('https://raw.githubusercontent.com/jeffnieman11/Data608_Final_Project/master/vehicles.csv', function(rows){

        function unpack(rows, key) {
            return rows.map(function(row) { return row[key]; });
        }

//Set up data to filter over Make
        var allMakeNames = unpack(rows, 'make'),
            allYear = unpack(rows, 'year'),
            allmpg = unpack(rows, 'comb08'),
            listofMakes = [],
            currentMake,
            currentmpg = [],
            currentYear = [];

        for (var i = 0; i < allMakeNames.length; i++ ){
            if (listofMakes.indexOf(allMakeNames[i]) === -1 ){
                listofMakes.push(allMakeNames[i]);
            }
        }

        function getMakeData(chosenMake) {
            currentmpg = [];
            currentYear = [];
            for (var i = 0 ; i < allMakeNames.length ; i++){
                if ( allMakeNames[i] === chosenMake ) {
                    currentmpg.push(allmpg[i]);
                    currentYear.push(allYear[i]);
                }
            }
        };

        // Default Make Data to display
        setBubblePlot('Ford');

        function setBubblePlot(chosenMake) {
            getMakeData(chosenMake);

            //Set up graph type

            var trace1 = {
                x: currentYear,
                y: currentmpg,
                type: 'scatter',
                mode: 'markers',
                marker: {
                    size: 5,
                    opacity: 0.5
                }
            };

            var data = [trace1];
            // Add title to graph
            var layout = {
                title:'Mpg by Year by Make',
                height: 400,
                width: 480
            };

            //Read data into graph
            Plotly.newPlot('plotdiv', data, layout);
        };

        var innerContainer = document.querySelector('[data-num="0"'),
            plotEl = innerContainer.querySelector('.plot'),
            MakeSelector = innerContainer.querySelector('.Makedata');

        function assignOptions(textArray, selector) {
            for (var i = 0; i < textArray.length;  i++) {
                var currentOption = document.createElement('option');
                currentOption.text = textArray[i];
                selector.appendChild(currentOption);
            }
        }

        assignOptions(listofMakes, MakeSelector);

        function updateMake(){
            setBubblePlot(MakeSelector.value);
        }

        MakeSelector.addEventListener('change', updateMake, false);

});

        </script>
    </body>

</html>
